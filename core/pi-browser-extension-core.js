(function(){"use strict";const s=/^(?:pi|https):\/\/app-cdn\.minepi\.com\/mobile-app-ui\/app\/(.*?)(?:$|\/)/,l={brainstorm:"pi://brainstorm.pi",kyc:"pi://kyc.pi",devportal:"pi://develop.pi",translate:"pi://translate.pi","platform-demo-app":"pi://demo.pi",ecosystem:"pi://testnetecosystem.pi",chat:"pi://chat.pi",fireside:"pi://fireside.pinet.com"},d=/^(?:pi|https):\/\/app-cdn\.minepi\.com\/mobile-app-ui\/(.*?)(?:\?.*|$|\/)/,r={welcome:"pi://welcome.pi",chat:"pi://_LEGACY_chat.pi",wallet:"pi://wallet.pi",feed:"pi://mine.pi",error:"pi://error.pi"};function g(t){const e=t.replace("https://","pi://");if(s.test(e)){const[,o]=s.exec(e)??[];return o in l?l[o]:e}if(d.test(e)){const[,o]=d.exec(e)??[];return o in r?r[o]:r.welcome}return e.startsWith("pi://blockexplorer.minepi.com/")||e.startsWith("pi://minepi.com/blockexplorer/")?"pi://blockchain.pi":e}function b(){const e=new URL(window.location.href).searchParams.get("url");return e?e.replace("pi://","https://"):r.welcome.replace("pi://","https://")}async function v(t){const e=localStorage.getItem("mobile-app-webview-ui_access-token");if(!e)return t;let o;try{o=new URL(t).hostname}catch{return`https://app-cdn.minepi.com/mobile-app-ui/error?url=${encodeURIComponent(t)}`}const n=await(await fetch(`https://socialchain.app/api/mobile_app/resolved_url?q=${o}`,{headers:{Authorization:e}}).catch()).json();return n.redirect_url?n.redirect_url.replace("http://","https://")+new URL(t).pathname:t}function m(t,e="replace"){const o=t?g(t):"";switch(e){case"push":{window.history.pushState({},"",`/browser?url=${o}`);break}case"pop":{window.history.back();break}case"replace":{window.history.replaceState({},"",`/browser?url=${o}`);break}}}function y(t){const{body:e}=new DOMParser().parseFromString(t,"text/html"),o=[...e.children];return o.length===1?o[0]:o}var c=(t=>(t.INIT_NAVIGATION="@pi:browser:init-navigation",t.NAVIGATION_CHANGE="@pi:browser:navigation-change",t.UNKNOWN="unknown",t))(c||{});function I(t){const e=document.querySelector("iframe");e&&(e.src=t)}function N(t){t.addEventListener("load",()=>{t.contentWindow?.postMessage({type:c.INIT_NAVIGATION})}),window.addEventListener("message",e=>{e.data.type===c.NAVIGATION_CHANGE&&(e.data.payload.navigate&&I(e.data.payload.url),m(e.data.payload.url,e.data.payload.action))})}function k(t,e){const o=y(`<iframe src="${e}" allow="clipboard-read; clipboard-write; camera" style="width: 100vw; height: 100vh; border: none;"></iframe>`);N(o),t.append(o)}function S(t,e,o){const i=new MutationObserver((n,p)=>{for(const U of n)e(U,p)});return i.observe(t,{childList:!0,subtree:!0,...o}),()=>i.disconnect()}function _(t,e=document.documentElement){return new Promise(o=>{S(e,(i,n)=>{const p=e.querySelector(t);p&&(n.disconnect(),o(p))})})}async function A(){const t=await _("#root"),e=b(),o=await v(e);k(t,o);const i=s.test(o)?e:o;m(i)}const u={platform:{desktop:!0,os:"win32",version:"10.0.0",arch:"x64",uuid:"",hostApp:"pi-node"},bundleData:{versionNumber:"1.8.0",buildNumber:"30"},nativeSupport:{requestPermission:!0,inlineMediaPlayback:!0}},a=structuredClone(u);a.platform.hostApp="pi-browser",a.platform.desktop=!1,a.platform.os="android";const w=a;function f(t){localStorage.setItem("@pi:webview_ui_behaviors",JSON.stringify(t)),window.location.reload()}function h(){const t=localStorage.getItem("@pi:webview_ui_behaviors"),e=localStorage.getItem("mobile-app-webview-ui_access-token"),o=localStorage.getItem("@pi:logged-in");e&&t!==JSON.stringify(w)?(f(w),window.location.reload()):!e&&!o&&(f(u),localStorage.setItem("@pi:logged-in","false"),window.location.href="https://app-cdn.minepi.com/mobile-app-ui/node-signin"),window.location.href!=="https://app-cdn.minepi.com/mobile-app-ui/node-signin"&&o==="false"&&(window.location.href="https://app-cdn.minepi.com/mobile-app-ui/node-signin"),e&&o==="false"&&(localStorage.setItem("@pi:logged-in","true"),window.location.href="https://app-cdn.minepi.com/browser"),window.location.href.startsWith("https://app-cdn.minepi.com/browser")&&A()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>h(),{once:!0}):h()})();
