(function(){"use strict";const s=/^(?:pi|https):\/\/app-cdn\.minepi\.com\/mobile-app-ui\/app\/(.*?)(?:$|\/)/,c={brainstorm:"pi://brainstorm.pi",kyc:"pi://kyc.pi",devportal:"pi://develop.pi",translate:"pi://translate.pi","platform-demo-app":"pi://demo.pi",ecosystem:"pi://testnetecosystem.pi",chat:"pi://chat.pi",fireside:"pi://fireside.pinet.com"},l=/^(?:pi|https):\/\/app-cdn\.minepi\.com\/mobile-app-ui\/(.*?)(?:\?.*|$|\/)/,r={welcome:"pi://welcome.pi",chat:"pi://_LEGACY_chat.pi",wallet:"pi://wallet.pi",feed:"pi://mine.pi",error:"pi://error.pi"};function h(t){const e=t.replace("https://","pi://");if(s.test(e)){const[,i]=s.exec(e)??[];return i in c?c[i]:e}if(l.test(e)){const[,i]=l.exec(e)??[];return i in r?r[i]:r.feed}return e.startsWith("pi://blockexplorer.minepi.com/")||e.startsWith("pi://minepi.com/blockexplorer/")?"pi://blockchain.pi":e}function g(){const e=new URL(window.location.href).searchParams.get("url");return e?e.replace("pi://","https://"):r.welcome.replace("pi://","https://")}async function b(t){const e=localStorage.getItem("mobile-app-webview-ui_access-token");if(!e)return t;let i;try{i=new URL(t).hostname}catch{return`https://app-cdn.minepi.com/mobile-app-ui/error?url=${encodeURIComponent(t)}`}const n=await(await fetch(`https://socialchain.app/api/mobile_app/resolved_url?q=${i}`,{headers:{Authorization:e}}).catch()).json();return n.redirect_url?n.redirect_url.replace("http://","https://")+new URL(t).pathname:t}function d(t,e="replace"){const i=t?h(t):"";switch(e){case"push":{window.history.pushState({},"",`/browser?url=${i}`);break}case"pop":{window.history.back();break}case"replace":{window.history.replaceState({},"",`/browser?url=${i}`);break}}}function y(t){const{body:e}=new DOMParser().parseFromString(t,"text/html"),i=[...e.children];return i.length===1?i[0]:i}function v(t){const e=document.querySelector("iframe");e&&(e.src=t)}function k(t){t.addEventListener("load",()=>{t.contentWindow?.postMessage({type:"@pi:browser:init_navigation"})}),window.addEventListener("message",e=>{e.data.type==="@pi:browser:navigation_change"&&(e.data.payload.navigate&&v(e.data.payload.url),d(e.data.payload.url,e.data.payload.action))})}function S(t,e){const i=y(`<iframe src="${e}" allow="clipboard-read; clipboard-write; camera" style="width: 100vw; height: 100vh; border: none;"></iframe>`);k(i),t.append(i)}function _(t,e,i){const o=new MutationObserver((n,p)=>{for(const I of n)e(I,p)});return o.observe(t,{childList:!0,subtree:!0,...i}),()=>o.disconnect()}function U(t,e=document.documentElement){return new Promise(i=>{_(e,(o,n)=>{const p=e.querySelector(t);p&&(n.disconnect(),i(p))})})}async function L(){const t=await U("#root"),e=g(),i=await b(e);S(t,i);const o=s.test(i)?e:i;d(o)}const m={platform:{desktop:!0,os:"win32",version:"10.0.0",arch:"x64",uuid:"",hostApp:"pi-node"},bundleData:{versionNumber:"1.7.1",buildNumber:"26"},nativeSupport:{requestPermissions:!0,inlineMediaPlayback:!0}},a=structuredClone(m);a.platform.hostApp="pi-browser",a.platform.desktop=!1,a.platform.os="android";const u=a;function w(t){localStorage.setItem("@pi:webview_ui_behaviors",JSON.stringify(t)),window.location.reload()}function f(){const t=localStorage.getItem("@pi:webview_ui_behaviors"),e=localStorage.getItem("mobile-app-webview-ui_access-token"),i=localStorage.getItem("@pi:logged-in");e&&t!==JSON.stringify(u)?w(u):!e&&!i&&(w(m),localStorage.setItem("@pi:logged-in","false"),window.location.href="https://app-cdn.minepi.com/mobile-app-ui/node-signin"),window.location.href!=="https://app-cdn.minepi.com/mobile-app-ui/node-signin"&&i==="false"&&(window.location.href="https://app-cdn.minepi.com/mobile-app-ui/node-signin"),e&&i==="false"&&(localStorage.setItem("@pi:logged-in","true"),window.location.href="https://app-cdn.minepi.com/browser"),window.location.href.startsWith("https://app-cdn.minepi.com/browser")&&L()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>f(),{once:!0}):f()})();
